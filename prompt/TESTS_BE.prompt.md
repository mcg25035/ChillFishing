# 後端測試說明 (Backend Test Documentation)

本文件說明為 ChillFishing 專案後端 API 撰寫的測試。

## 測試檔案位置
所有後端測試檔案均位於 `tests/` 目錄下。
主要測試檔案為 `tests/backend.test.js`。

## 測試工具
- **Jest**: 作為測試框架。
- **Supertest**: 用於對 HTTP 請求進行測試。

## 測試範圍
`tests/backend.test.js` 包含了對 `BE/server.js` 中定義的後端 API 的測試。

### 已涵蓋的 API 端點:
- `GET /api/items`:
    - 測試在沒有項目時返回空陣列。
    - 測試在有項目時返回所有項目。
    - 預留處理伺服器錯誤的測試案例。
- `POST /api/items`:
    - 測試成功創建帶有名稱和描述的新項目。
    - 測試成功創建只帶有名稱的新項目。
    - 測試缺少 `name` 字段時返回 400 錯誤。
    - 預留處理重複名稱（如果業務邏輯要求唯一性）的測試案例。
    - 預留處理伺服器錯誤的測試案例。

### 未來功能預留測試:
根據 `prompt/GLOBAL.prompt.md` 中的需求，測試檔案中也為未來將實現的管理員和抽獎者相關 API 預留了測試結構。這些測試目前被註釋掉，待後端對應功能實作完成後即可取消註釋並啟用。
- **管理員 API 測試**:
    - 驗證管理員操作需要身份驗證 (`secret_identify_text`)。
    - 測試已驗證的管理員管理獎品機率和數量。
    - 測試已驗證的管理員新增銘謝惠顧替代字。
    - 測試已驗證的管理員建立活動 token。
- **抽獎者 API 測試**:
    - 測試參與者使用有效 token 進入抽獎。
    - 測試阻止參與者使用無效 token 進入抽獎。
    - 測試參與者通過連結/代碼進入公開活動。

## 測試運行方式
由於專案限制，測試程式碼**未修改後端 `BE/server.js` 檔案**。這意味著：
1.  後端伺服器必須在運行測試之前手動啟動。
    - 請在 `BE/` 目錄下運行 `node server.js` 或 `npm start` (如果已配置)。
2.  測試將直接連接到 `http://localhost:3001` 上運行的後端伺服器。
3.  測試將使用後端預設的資料庫檔案 (`./chillfishing.db`)。
    - **重要提示**: 由於測試會對資料庫進行寫入和讀取操作，這可能會影響您的開發資料庫。在運行測試之前，建議您備份 `BE/chillfishing.db`，或在專門的測試環境中運行。

## 如何執行測試
1.  確保您已在 `tests/` 目錄下安裝了所有必要的 npm 套件：
    ```bash
    cd tests
    npm install
    ```
2.  手動啟動後端伺服器（在另一個終端機視窗中）：
    ```bash
    cd BE
    node server.js
    ```
3.  在 `tests/` 目錄下運行測試：
    ```bash
    cd tests
    npm test
